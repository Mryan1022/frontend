<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”¨ä¾‹ä»“åº“ - é¡µé¢é¢„è§ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', Arial, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* åˆ›å»ºç‰ˆæœ¬é¢æ¿ */
        .version-create-panel {
            background: white;
            padding: 25px;
            margin: 20px 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .version-create-panel h2 {
            color: #667eea;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-create {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .btn-create:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
        }

        /* ä¸»è¦å†…å®¹åŒºåŸŸ */
        .main-container {
            display: flex;
            gap: 20px;
            margin: 0 30px 30px;
        }

        /* å·¦ä¾§ä»“åº“èœå•æ ‘ */
        .repository-section {
            flex: 1;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }

        .section-header {
            font-size: 18px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e5e7eb;
        }

        .menu-tree {
            margin-top: 15px;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .menu-item:hover {
            background: #f3f4f6;
        }

        .menu-item.selected {
            background: #dbeafe;
            border-left: 3px solid #3b82f6;
        }

        .menu-checkbox {
            margin-right: 10px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .menu-icon {
            margin-right: 8px;
            font-size: 16px;
        }

        .menu-name {
            flex: 1;
            font-size: 14px;
            color: #374151;
        }

        .menu-count {
            font-size: 12px;
            color: #6b7280;
            background: #f3f4f6;
            padding: 2px 8px;
            border-radius: 12px;
        }

        .submenu-list {
            margin-left: 35px;
        }

        /* å³ä¾§ç”¨ä¾‹åŒºåŸŸ */
        .testcase-section {
            flex: 1.5;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .testcase-toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e5e7eb;
        }

        .testcase-actions {
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 13px;
            border: 1px solid #d1d5db;
            background: white;
            color: #374151;
            border-radius: 4px;
            cursor: pointer;
        }

        .btn-small:hover {
            background: #f9fafb;
            border-color: #9ca3af;
        }

        .testcase-list-container {
            flex: 1;
            overflow-y: auto;
        }

        .testcase-list {
            max-height: 500px;
        }

        .testcase-item {
            display: flex;
            align-items: center;
            padding: 12px;
            margin: 5px 0;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            transition: all 0.2s;
            cursor: pointer;
        }

        .testcase-item:hover {
            border-color: #3b82f6;
            background: #f9fafb;
        }

        .testcase-item.selected {
            background: #dbeafe;
            border-color: #3b82f6;
        }

        .testcase-checkbox {
            margin-right: 12px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .testcase-id {
            font-size: 12px;
            color: #6b7280;
            background: #f3f4f6;
            padding: 4px 8px;
            border-radius: 4px;
            margin-right: 10px;
            font-family: monospace;
        }

        .testcase-name {
            flex: 1;
            font-size: 14px;
            color: #374151;
        }

        .testcase-priority {
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 12px;
            font-weight: 500;
        }

        .priority-p0 {
            background: #fee2e2;
            color: #dc2626;
        }

        .priority-p1 {
            background: #fed7aa;
            color: #ea580c;
        }

        .priority-p2 {
            background: #dbeafe;
            color: #2563eb;
        }

        /* ç”¨ä¾‹è¯¦æƒ…é¢æ¿ */
        .testcase-detail {
            border-top: 2px solid #e5e7eb;
            padding-top: 20px;
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
        }

        .detail-header {
            font-size: 16px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .detail-section {
            margin-bottom: 15px;
        }

        .detail-label {
            font-size: 13px;
            color: #6b7280;
            font-weight: 500;
            margin-bottom: 5px;
        }

        .detail-content {
            font-size: 14px;
            color: #374151;
            background: #f9fafb;
            padding: 10px;
            border-radius: 4px;
            line-height: 1.6;
        }

        .detail-content ul {
            margin-left: 20px;
        }

        .detail-content li {
            margin: 5px 0;
        }

        /* åº•éƒ¨ç»Ÿè®¡ */
        .selection-summary {
            background: white;
            padding: 15px 30px;
            margin: 0 30px 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .summary-stats {
            display: flex;
            gap: 30px;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stat-label {
            color: #6b7280;
            font-size: 14px;
        }

        .stat-value {
            color: #667eea;
            font-size: 20px;
            font-weight: bold;
        }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #9ca3af;
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 15px;
        }

        /* æç¤ºä¿¡æ¯ */
        .info-box {
            background: #eff6ff;
            border-left: 4px solid #3b82f6;
            padding: 12px 16px;
            margin-bottom: 20px;
            border-radius: 4px;
        }

        .info-box p {
            margin: 0;
            color: #1e40af;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <!-- é¡µé¢å¤´éƒ¨ -->
    <div class="header">
        <h1>ğŸ“¦ ç”¨ä¾‹ä»“åº“</h1>
        <div class="user-section">
            <div class="user-info">
                <div>ğŸ‘¤</div>
                <span>Admin</span>
            </div>
            <button class="logout-btn">é€€å‡ºç™»å½•</button>
        </div>
    </div>

    <!-- åˆ›å»ºç‰ˆæœ¬é¢æ¿ -->
    <div class="version-create-panel">
        <div>
            <h2>ğŸ¯ åˆ›å»ºæ–°ç‰ˆæœ¬</h2>
            <div class="info-box" style="margin-top: 10px;">
                <p>ğŸ’¡ ä»å…¨é‡ç”¨ä¾‹ä¸­é€‰æ‹©éœ€è¦çš„æ¨¡å—ï¼Œç‚¹å‡»"åˆ›å»ºç‰ˆæœ¬"æŒ‰é’®å³å¯åˆ›å»ºæ–°ç‰ˆæœ¬æµ‹è¯•ã€‚</p>
            </div>
        </div>
        <button class="btn btn-create" onclick="createVersion()">âœ… åˆ›å»ºç‰ˆæœ¬</button>
    </div>

    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <div class="main-container">
        <!-- å·¦ä¾§ï¼šä»“åº“èœå•æ ‘ -->
        <div class="repository-section">
            <div class="section-header">å…¨é‡ç”¨ä¾‹</div>

            <div class="menu-tree" id="menuTree">
                <!-- JavaScript åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>

        <!-- å³ä¾§ï¼šç”¨ä¾‹åˆ—è¡¨ + è¯¦æƒ… -->
        <div class="testcase-section">
            <div class="section-header">ğŸ“‹ ç”¨ä¾‹åˆ—è¡¨</div>

            <div class="testcase-toolbar">
                <div style="color: #6b7280; font-size: 14px;">
                    å½“å‰èœå•: <strong style="color: #374151;" id="currentMenuName">è¯·é€‰æ‹©èœå•</strong>
                </div>
                <div class="testcase-actions">
                    <button class="btn btn-small" onclick="selectAllTestCases()">â˜‘ï¸ å…¨é€‰</button>
                    <button class="btn btn-small" onclick="unselectAllTestCases()">â˜ å…¨ä¸é€‰</button>
                </div>
            </div>

            <div class="testcase-list-container">
                <div class="testcase-list" id="testcaseList">
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“‹</div>
                        <p>è¯·åœ¨å·¦ä¾§é€‰æ‹©èœå•æŸ¥çœ‹ç”¨ä¾‹</p>
                    </div>
                </div>

                <!-- ç”¨ä¾‹è¯¦æƒ… -->
                <div class="testcase-detail" id="testcaseDetail" style="display: none;">
                    <!-- JavaScript åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>

    <!-- åº•éƒ¨ç»Ÿè®¡ -->
    <div class="selection-summary">
        <div class="summary-stats">
            <div class="stat-item">
                <span class="stat-label">å·²é€‰æ¨¡å—:</span>
                <span class="stat-value" id="selectedMenuCount">0</span>
                <span class="stat-label">ä¸ª</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">å·²é€‰ç”¨ä¾‹:</span>
                <span class="stat-value" id="selectedTestCaseCount">0</span>
                <span class="stat-label">æ¡</span>
            </div>
        </div>
        <div style="color: #6b7280; font-size: 13px;">
            ğŸ’¡ ç‚¹å‡»"åˆ›å»ºç‰ˆæœ¬"å°†é€‰ä¸­çš„æ¨¡å—å’Œç”¨ä¾‹å¤åˆ¶åˆ°é¦–é¡µ
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿæ•°æ®
        const menuData = [
            {
                id: 'menu1',
                name: 'ç™»å½•æ¨¡å—ï¼ˆæ¨¡æ¿ï¼‰',
                level: 1,
                children: [
                    { id: 'menu1_1', name: 'åŸºç¡€ç™»å½•', level: 2, parent: 'menu1' },
                    { id: 'menu1_2', name: 'ç¬¬ä¸‰æ–¹ç™»å½•', level: 2, parent: 'menu1' }
                ]
            },
            {
                id: 'menu2',
                name: 'æ”¯ä»˜æ¨¡å—ï¼ˆæ¨¡æ¿ï¼‰',
                level: 1,
                children: [
                    { id: 'menu2_1', name: 'åœ¨çº¿æ”¯ä»˜', level: 2, parent: 'menu2' },
                    { id: 'menu2_2', name: 'ä½™é¢æ”¯ä»˜', level: 2, parent: 'menu2' }
                ]
            },
            {
                id: 'menu3',
                name: 'ç›´æ’­æ¨¡å—ï¼ˆæ¨¡æ¿ï¼‰',
                level: 1,
                children: []
            }
        ];

        const testCaseData = {
            'menu1': [
                { id: 'TC001', name: 'è´¦å·å¯†ç ç™»å½•', priority: 'P0', preconditions: ['ç”¨æˆ·æœªç™»å½•'], steps: ['1. è¾“å…¥è´¦å·', '2. è¾“å…¥å¯†ç ', '3. ç‚¹å‡»ç™»å½•'], expectedResults: ['ç™»å½•æˆåŠŸï¼Œè·³è½¬åˆ°é¦–é¡µ'] },
                { id: 'TC002', name: 'æ‰‹æœºå·éªŒè¯ç ç™»å½•', priority: 'P0', preconditions: ['ç”¨æˆ·æœªç™»å½•'], steps: ['1. è¾“å…¥æ‰‹æœºå·', '2. è·å–éªŒè¯ç ', '3. è¾“å…¥éªŒè¯ç ', '4. ç‚¹å‡»ç™»å½•'], expectedResults: ['ç™»å½•æˆåŠŸ'] },
                { id: 'TC007', name: 'ç™»å½•çŠ¶æ€ä¿æŒ', priority: 'P1', preconditions: ['ç”¨æˆ·å·²ç™»å½•'], steps: ['1. å…³é—­æµè§ˆå™¨', '2. é‡æ–°æ‰“å¼€'], expectedResults: ['ä»ç„¶ä¿æŒç™»å½•çŠ¶æ€'] },
                { id: 'TC008', name: 'è‡ªåŠ¨ç™»å½•', priority: 'P2', preconditions: ['å‹¾é€‰äº†è®°ä½å¯†ç '], steps: ['1. æ‰“å¼€åº”ç”¨'], expectedResults: ['è‡ªåŠ¨ç™»å½•æˆåŠŸ'] }
            ],
            'menu1_1': [
                { id: 'TC001', name: 'è´¦å·å¯†ç ç™»å½•', priority: 'P0', preconditions: ['ç”¨æˆ·æœªç™»å½•'], steps: ['1. è¾“å…¥è´¦å·', '2. è¾“å…¥å¯†ç ', '3. ç‚¹å‡»ç™»å½•'], expectedResults: ['ç™»å½•æˆåŠŸï¼Œè·³è½¬åˆ°é¦–é¡µ'] },
                { id: 'TC002', name: 'æ‰‹æœºå·éªŒè¯ç ç™»å½•', priority: 'P0', preconditions: ['ç”¨æˆ·æœªç™»å½•'], steps: ['1. è¾“å…¥æ‰‹æœºå·', '2. è·å–éªŒè¯ç ', '3. è¾“å…¥éªŒè¯ç ', '4. ç‚¹å‡»ç™»å½•'], expectedResults: ['ç™»å½•æˆåŠŸ'] },
                { id: 'TC003', name: 'å¿˜è®°å¯†ç ', priority: 'P1', preconditions: ['ç”¨æˆ·å¿˜è®°å¯†ç '], steps: ['1. ç‚¹å‡»å¿˜è®°å¯†ç ', '2. è¾“å…¥æ‰‹æœºå·', '3. éªŒè¯ç éªŒè¯', '4. è®¾ç½®æ–°å¯†ç '], expectedResults: ['å¯†ç é‡ç½®æˆåŠŸ'] },
                { id: 'TC005', name: 'ç™»å½•å¤±è´¥æç¤º', priority: 'P2', preconditions: ['ç”¨æˆ·æœªç™»å½•'], steps: ['1. è¾“å…¥é”™è¯¯å¯†ç ', '2. ç‚¹å‡»ç™»å½•'], expectedResults: ['æç¤ºå¯†ç é”™è¯¯'] }
            ],
            'menu1_2': [
                { id: 'TC004', name: 'å¾®ä¿¡å¿«æ·ç™»å½•', priority: 'P1', preconditions: ['ç”¨æˆ·å·²ç»‘å®šå¾®ä¿¡'], steps: ['1. ç‚¹å‡»å¾®ä¿¡ç™»å½•', '2. æˆæƒ'], expectedResults: ['ç™»å½•æˆåŠŸ'] },
                { id: 'TC006', name: 'QQ å¿«æ·ç™»å½•', priority: 'P2', preconditions: ['ç”¨æˆ·å·²ç»‘å®šQQ'], steps: ['1. ç‚¹å‡»QQç™»å½•', '2. æˆæƒ'], expectedResults: ['ç™»å½•æˆåŠŸ'] }
            ],
            'menu2': [
                { id: 'TC101', name: 'å¾®ä¿¡æ”¯ä»˜', priority: 'P0', preconditions: ['ç”¨æˆ·å·²ç™»å½•', 'ä½™é¢å……è¶³'], steps: ['1. é€‰æ‹©å•†å“', '2. é€‰æ‹©å¾®ä¿¡æ”¯ä»˜', '3. ç¡®è®¤æ”¯ä»˜'], expectedResults: ['æ”¯ä»˜æˆåŠŸ'] },
                { id: 'TC102', name: 'æ”¯ä»˜å®æ”¯ä»˜', priority: 'P0', preconditions: ['ç”¨æˆ·å·²ç™»å½•'], steps: ['1. é€‰æ‹©å•†å“', '2. é€‰æ‹©æ”¯ä»˜å®', '3. ç¡®è®¤æ”¯ä»˜'], expectedResults: ['æ”¯ä»˜æˆåŠŸ'] }
            ],
            'menu2_1': [
                { id: 'TC101', name: 'å¾®ä¿¡æ”¯ä»˜', priority: 'P0', preconditions: ['ç”¨æˆ·å·²ç™»å½•', 'ä½™é¢å……è¶³'], steps: ['1. é€‰æ‹©å•†å“', '2. é€‰æ‹©å¾®ä¿¡æ”¯ä»˜', '3. ç¡®è®¤æ”¯ä»˜'], expectedResults: ['æ”¯ä»˜æˆåŠŸ'] },
                { id: 'TC102', name: 'æ”¯ä»˜å®æ”¯ä»˜', priority: 'P0', preconditions: ['ç”¨æˆ·å·²ç™»å½•'], steps: ['1. é€‰æ‹©å•†å“', '2. é€‰æ‹©æ”¯ä»˜å®', '3. ç¡®è®¤æ”¯ä»˜'], expectedResults: ['æ”¯ä»˜æˆåŠŸ'] }
            ],
            'menu2_2': [
                { id: 'TC103', name: 'ä½™é¢æ”¯ä»˜', priority: 'P1', preconditions: ['ç”¨æˆ·ä½™é¢å……è¶³'], steps: ['1. é€‰æ‹©ä½™é¢æ”¯ä»˜', '2. ç¡®è®¤'], expectedResults: ['æ”¯ä»˜æˆåŠŸ'] }
            ],
            'menu3': [
                { id: 'TC201', name: 'å¼€å¯ç›´æ’­', priority: 'P0', preconditions: ['ç”¨æˆ·å·²å®å'], steps: ['1. ç‚¹å‡»å¼€æ’­', '2. è®¾ç½®æ ‡é¢˜', '3. å¼€å§‹ç›´æ’­'], expectedResults: ['ç›´æ’­å¼€å¯æˆåŠŸ'] }
            ]
        };

        let selectedMenus = new Set();
        let selectedTestCases = new Set();
        let currentMenu = null;
        let currentTestCase = null;

        // åˆå§‹åŒ–é¡µé¢
        function init() {
            renderMenuTree();
            updateStatistics();
        }

        // æ¸²æŸ“èœå•æ ‘
        function renderMenuTree() {
            const container = document.getElementById('menuTree');
            container.innerHTML = '';

            menuData.forEach(menu => {
                // ä¸€çº§èœå•
                const menuItem = createMenuItem(menu);
                container.appendChild(menuItem);

                // å­èœå•
                if (menu.children && menu.children.length > 0) {
                    const submenuList = document.createElement('div');
                    submenuList.className = 'submenu-list';
                    submenuList.id = `submenu_${menu.id}`;

                    menu.children.forEach(submenu => {
                        const submenuItem = createMenuItem(submenu);
                        submenuList.appendChild(submenuItem);
                    });

                    container.appendChild(submenuList);
                }
            });
        }

        // åˆ›å»ºèœå•é¡¹
        function createMenuItem(menu) {
            const div = document.createElement('div');
            div.className = 'menu-item';
            div.id = `menuitem_${menu.id}`;

            const testCases = testCaseData[menu.id] || [];
            const count = testCases.length;

            div.innerHTML = `
                <input type="checkbox" class="menu-checkbox" id="checkbox_${menu.id}" ${menu.level === 1 ? 'checked' : 'checked'}>
                <span class="menu-icon">${menu.level === 1 ? 'ğŸ“‚' : 'ğŸ“„'}</span>
                <span class="menu-name">${menu.name}</span>
                <span class="menu-count">${count} ç”¨ä¾‹</span>
            `;

            // å¤é€‰æ¡†äº‹ä»¶
            const checkbox = div.querySelector('.menu-checkbox');
            checkbox.addEventListener('change', (e) => {
                e.stopPropagation();
                handleMenuCheckboxChange(menu, checkbox.checked);
            });

            // ç‚¹å‡»èœå•é¡¹æ˜¾ç¤ºç”¨ä¾‹
            div.addEventListener('click', (e) => {
                if (e.target.type === 'checkbox') return;
                selectMenu(menu);
            });

            // é»˜è®¤å‹¾é€‰
            if (menu.level === 1 || menu.level === 2) {
                selectedMenus.add(menu.id);
            }

            return div;
        }

        // å¤„ç†èœå•å¤é€‰æ¡†å˜åŒ–
        function handleMenuCheckboxChange(menu, checked) {
            if (checked) {
                selectedMenus.add(menu.id);
            } else {
                selectedMenus.delete(menu.id);
            }

            // å¦‚æœæ˜¯ä¸€çº§èœå•ï¼Œè”åŠ¨å­èœå•
            if (menu.level === 1) {
                const parentMenu = menuData.find(m => m.id === menu.id);
                if (parentMenu && parentMenu.children) {
                    parentMenu.children.forEach(child => {
                        const childCheckbox = document.getElementById(`checkbox_${child.id}`);
                        if (childCheckbox) {
                            childCheckbox.checked = checked;
                            if (checked) {
                                selectedMenus.add(child.id);
                            } else {
                                selectedMenus.delete(child.id);
                            }
                        }
                        // è”åŠ¨å­èœå•çš„ç”¨ä¾‹
                        updateTestCasesSelection(child.id, checked);
                    });
                }

                // è”åŠ¨ç”¨ä¾‹
                updateTestCasesSelection(menu.id, checked);
            }

            // å¦‚æœæ˜¯äºŒçº§èœå•ï¼Œæ›´æ–°çˆ¶èœå•çŠ¶æ€
            if (menu.level === 2) {
                updateParentCheckboxState(menu.parent);
                updateTestCasesSelection(menu.id, checked);
            }

            updateStatistics();
        }

        // æ›´æ–°çˆ¶èœå•å¤é€‰æ¡†çŠ¶æ€
        function updateParentCheckboxState(parentId) {
            const parent = menuData.find(m => m.id === parentId);
            if (!parent) return;

            const children = parent.children || [];
            const checkedCount = children.filter(c => {
                const cb = document.getElementById(`checkbox_${c.id}`);
                return cb && cb.checked;
            }).length;

            const parentCheckbox = document.getElementById(`checkbox_${parentId}`);
            if (parentCheckbox) {
                if (checkedCount === 0) {
                    parentCheckbox.checked = false;
                    parentCheckbox.indeterminate = false;
                } else if (checkedCount === children.length) {
                    parentCheckbox.checked = true;
                    parentCheckbox.indeterminate = false;
                } else {
                    parentCheckbox.checked = false;
                    parentCheckbox.indeterminate = true;
                }
            }
        }

        // æ›´æ–°ç”¨ä¾‹å‹¾é€‰çŠ¶æ€
        function updateTestCasesSelection(menuId, checked) {
            const testCases = testCaseData[menuId] || [];
            testCases.forEach(tc => {
                if (checked) {
                    selectedTestCases.add(tc.id);
                } else {
                    selectedTestCases.delete(tc.id);
                }

                // æ›´æ–°ç•Œé¢
                const checkbox = document.getElementById(`tc_checkbox_${tc.id}`);
                if (checkbox) {
                    checkbox.checked = checked;
                }
            });
        }

        // é€‰æ‹©èœå•
        function selectMenu(menu) {
            currentMenu = menu;

            // æ›´æ–°é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('selected');
            });
            document.getElementById(`menuitem_${menu.id}`).classList.add('selected');

            // æ˜¾ç¤ºç”¨ä¾‹åˆ—è¡¨
            renderTestCaseList(menu);

            // æ›´æ–°å½“å‰èœå•å
            document.getElementById('currentMenuName').textContent = menu.name;

            // éšè—è¯¦æƒ…
            document.getElementById('testcaseDetail').style.display = 'none';
        }

        // æ¸²æŸ“ç”¨ä¾‹åˆ—è¡¨
        function renderTestCaseList(menu) {
            const container = document.getElementById('testcaseList');
            const testCases = testCaseData[menu.id] || [];

            if (testCases.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“‹</div>
                        <p>è¯¥èœå•ä¸‹æš‚æ— ç”¨ä¾‹</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = '';
            testCases.forEach(tc => {
                const div = document.createElement('div');
                div.className = 'testcase-item';
                div.id = `testcase_${tc.id}`;

                const isChecked = selectedTestCases.has(tc.id);

                div.innerHTML = `
                    <input type="checkbox" class="testcase-checkbox" id="tc_checkbox_${tc.id}" ${isChecked ? 'checked' : ''}>
                    <div class="testcase-id">${tc.id}</div>
                    <div class="testcase-name">${tc.name}</div>
                    <div class="testcase-priority priority-${tc.priority.toLowerCase()}">${tc.priority}</div>
                `;

                // å¤é€‰æ¡†äº‹ä»¶
                const checkbox = div.querySelector('.testcase-checkbox');
                checkbox.addEventListener('change', (e) => {
                    e.stopPropagation();
                    if (checkbox.checked) {
                        selectedTestCases.add(tc.id);
                    } else {
                        selectedTestCases.delete(tc.id);
                    }
                    updateStatistics();
                });

                // ç‚¹å‡»æ˜¾ç¤ºè¯¦æƒ…
                div.addEventListener('click', (e) => {
                    if (e.target.type === 'checkbox') return;
                    showTestCaseDetail(tc);
                });

                container.appendChild(div);
            });
        }

        // æ˜¾ç¤ºç”¨ä¾‹è¯¦æƒ…
        function showTestCaseDetail(testCase) {
            currentTestCase = testCase;

            // æ›´æ–°é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.testcase-item').forEach(item => {
                item.classList.remove('selected');
            });
            document.getElementById(`testcase_${testCase.id}`).classList.add('selected');

            const detailDiv = document.getElementById('testcaseDetail');
            detailDiv.style.display = 'block';

            detailDiv.innerHTML = `
                <div class="detail-header">
                    ğŸ“„ ${testCase.id} - ${testCase.name}
                    <span class="testcase-priority priority-${testCase.priority.toLowerCase()}">${testCase.priority}</span>
                </div>

                <div class="detail-section">
                    <div class="detail-label">å‰ç½®æ¡ä»¶</div>
                    <div class="detail-content">
                        <ul>
                            ${testCase.preconditions.map(p => `<li>${p}</li>`).join('')}
                        </ul>
                    </div>
                </div>

                <div class="detail-section">
                    <div class="detail-label">æ“ä½œæ­¥éª¤</div>
                    <div class="detail-content">
                        <ul>
                            ${testCase.steps.map(s => `<li>${s}</li>`).join('')}
                        </ul>
                    </div>
                </div>

                <div class="detail-section">
                    <div class="detail-label">é¢„æœŸç»“æœ</div>
                    <div class="detail-content">
                        <ul>
                            ${testCase.expectedResults.map(r => `<li>${r}</li>`).join('')}
                        </ul>
                    </div>
                </div>
            `;
        }

        // å…¨é€‰ç”¨ä¾‹
        function selectAllTestCases() {
            if (!currentMenu) return;

            const testCases = testCaseData[currentMenu.id] || [];
            testCases.forEach(tc => {
                selectedTestCases.add(tc.id);
                const checkbox = document.getElementById(`tc_checkbox_${tc.id}`);
                if (checkbox) checkbox.checked = true;
            });

            updateStatistics();
        }

        // å…¨ä¸é€‰ç”¨ä¾‹
        function unselectAllTestCases() {
            if (!currentMenu) return;

            const testCases = testCaseData[currentMenu.id] || [];
            testCases.forEach(tc => {
                selectedTestCases.delete(tc.id);
                const checkbox = document.getElementById(`tc_checkbox_${tc.id}`);
                if (checkbox) checkbox.checked = false;
            });

            updateStatistics();
        }

        // æ›´æ–°ç»Ÿè®¡
        function updateStatistics() {
            document.getElementById('selectedMenuCount').textContent = selectedMenus.size;

            // è®¡ç®—å·²é€‰æ¨¡å—ä¸‹çš„ç”¨ä¾‹æ€»æ•°ï¼ˆå»é‡ï¼‰
            const uniqueTestCases = new Set();
            selectedMenus.forEach(menuId => {
                const testCases = testCaseData[menuId] || [];
                testCases.forEach(tc => uniqueTestCases.add(tc.id));
            });

            document.getElementById('selectedTestCaseCount').textContent = uniqueTestCases.size;
        }

        // åˆ›å»ºç‰ˆæœ¬
        function createVersion() {
            const versionName = prompt('è¯·è¾“å…¥ç‰ˆæœ¬åç§°ï¼š', '132å›å½’ç”¨ä¾‹');

            if (!versionName) {
                return; // ç”¨æˆ·å–æ¶ˆ
            }

            if (!versionName.trim()) {
                alert('ç‰ˆæœ¬åç§°ä¸èƒ½ä¸ºç©ºï¼');
                return;
            }

            const menuCount = selectedMenus.size;
            const testCaseCount = selectedTestCases.size;

            if (menuCount === 0) {
                alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªæ¨¡å—ï¼');
                return;
            }

            // è®¡ç®—å®é™…ç”¨ä¾‹æ•°ï¼ˆå»é‡ï¼‰
            const uniqueTestCases = new Set();
            selectedMenus.forEach(menuId => {
                const tcs = testCaseData[menuId] || [];
                tcs.forEach(tc => uniqueTestCases.add(tc.id));
            });
            const actualTestCaseCount = uniqueTestCases.size;

            if (actualTestCaseCount === 0) {
                alert('é€‰ä¸­çš„æ¨¡å—ä¸­æ²¡æœ‰ç”¨ä¾‹ï¼');
                return;
            }

            alert(`âœ… åˆ›å»ºæˆåŠŸï¼\n\nç‰ˆæœ¬åç§°: ${versionName}\nå·²é€‰æ¨¡å—: ${menuCount} ä¸ª\nå·²é€‰ç”¨ä¾‹: ${actualTestCaseCount} æ¡\n\næ–°ç‰ˆæœ¬å·²æ·»åŠ åˆ°é¦–é¡µï¼Œå¹¶æ ‡è®°ä¸ºè“è‰²èƒŒæ™¯ï¼ˆæ¥è‡ªä»“åº“ï¼‰ã€‚`);
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', () => {
            init();
        });
    </script>
</body>
</html>
